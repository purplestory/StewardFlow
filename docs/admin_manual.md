# StewardFlow - 관리자 메뉴얼

## 목차
1. [관리자 권한 개요](#관리자-권한-개요)
2. [관리페이지 접근](#관리페이지-접근)
3. [초기 설정](#초기-설정)
4. [기관 설정](#기관-설정)
5. [사용자 관리](#사용자-관리)
6. [승인 정책 설정](#승인-정책-설정)
7. [자원 관리](#자원-관리)
8. [예약 관리](#예약-관리)
9. [반납 확인](#반납-확인)
10. [감사 로그](#감사-로그)

---

## 관리자 권한 개요

### 역할 구분

**관리자 (Admin)**
- 모든 기능 접근 가능
- 기관 설정 변경
- 모든 사용자 관리
- 모든 자원 관리

**부서 관리자 (Manager)**
- 본인 부서 자원 관리
- 예약 승인/거부
- 반납 확인

**일반 사용자 (User)**
- 자원 조회 및 예약
- 본인 예약 관리

---

## 관리페이지 접근

**경로**: 상단 메뉴 > 사용자 이름 클릭 > **"관리페이지"**

**관리페이지 구성:**
- **자원 관리**: 물품, 공간, 차량 관리 및 예약 관리
- **사용자 관리**: 사용자 권한 관리 및 승인 정책 설정
- **메뉴 관리**: 메뉴 설정 및 카테고리 관리
- **시스템 설정**: 기관 설정, 부서 관리, 정책 설정

**접근 권한:**
- 관리자: 모든 관리 기능 접근 가능
- 부서 관리자: 자원 관리 일부 기능만 접근 가능
- 일반 사용자: 접근 불가

---

## 초기 설정

### 1. 기관 생성

최초 로그인 시 기관이 없으면 기관을 생성해야 합니다.

1. 로그인 후 상단 메뉴에서 사용자 메뉴 > **"관리페이지"** 클릭
2. **"시스템 설정"** 카드 클릭
3. **"기관 생성"** 버튼 클릭
4. 기관명 입력 (예: "○○교회")
5. 생성 완료

### 2. 기본 기능 활성화

**기관 설정 > 서비스 메뉴 설정**에서 사용할 기능을 선택합니다:

- ✅ **물품 관리**: 기본 활성화
- ✅ **공간 관리**: 기본 활성화
- ⬜ **차량 관리**: 선택 사항

### 3. 메뉴 라벨 및 순서 설정

**경로**: 시스템 설정 > **"메뉴 설정"**

**메뉴 라벨 커스터마이징:**
- 각 메뉴의 표시 이름 변경 가능
- 물품: "물품" (기본값)
- 공간: "공간" (기본값)
- 차량: "차량" (기본값)

**메뉴 순서 변경:**
- 드래그앤드롭으로 메뉴 순서 변경
- 각 메뉴 항목 왼쪽의 드래그 핸들 아이콘을 클릭하고 드래그
- 순서 변경 후 **"설정 저장"** 버튼 클릭
- 각 메뉴의 활성화/비활성화 설정

### 4. 샘플 데이터 생성 (선택사항)

테스트를 위해 샘플 데이터를 생성할 수 있습니다:

1. **"물품 등록"** 또는 **"공간 등록"** 페이지로 이동
2. 하단의 **"샘플 데이터 생성"** 섹션 확인
3. **"샘플 데이터 생성"** 버튼 클릭
4. 생성된 샘플 데이터 확인

---

## 기관 설정

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"시스템 설정"** 또는 상단 메뉴 > **"관리" > "기관 설정"**

### 1. 기관 정보 수정

- 기관명 변경
- 기관 삭제 (주의: 모든 데이터가 삭제됩니다)

### 2. 부서 관리

**부서 추가:**
1. **"새 부서 생성"** 섹션에서:
   - 부서명 입력 (필수)
   - 부서 설명 입력 (선택사항)
2. **"부서 생성"** 버튼 클릭

**부서 수정:**
1. 부서 목록에서 **"수정"** 버튼 클릭
2. 부서명 또는 설명 수정
3. **"저장"** 버튼 클릭

**부서 삭제:**
1. 부서 목록에서 **"삭제"** 버튼 클릭
2. 확인 후 삭제
3. 주의: 부서 삭제 시 해당 부서 소유 자원의 부서 정보가 초기화됩니다

**부서 순서 변경:**
- 부서 목록에서 드래그앤드롭으로 순서 변경
- 각 부서 항목 왼쪽의 드래그 핸들 아이콘을 클릭하고 드래그
- 순서 변경 시 자동 저장됨
- 변경된 순서는 사용자 초대 페이지의 부서 선택 드롭다운에도 반영됨

**주요 부서 예시:**
- 유년부
- 중고등부
- 청년부
- 주일학교
- 방송팀
- 찬양팀

### 3. 카테고리 관리

**경로**: 시스템 설정 > **"메뉴 설정"** > 카테고리 관리 섹션

**카테고리 추가:**
1. **"카테고리명"** 입력 (예: "음향", "영상", "조리")
2. **"추가"** 버튼 클릭
3. 카테고리 코드는 시스템에서 자동 생성됩니다

**카테고리 수정:**
1. 카테고리 목록에서 **"수정"** 버튼 클릭
2. 카테고리명 수정
3. **"저장"** 버튼 클릭

**카테고리 삭제:**
1. 카테고리 목록에서 **"삭제"** 버튼 클릭
2. 확인 후 삭제

**카테고리 순서 변경:**
- 드래그앤드롭으로 카테고리 순서 변경
- 각 카테고리 항목 왼쪽의 드래그 핸들 아이콘을 클릭하고 드래그
- 순서 변경 시 자동 저장됨
- 변경된 순서는 물품 등록/수정 시 카테고리 선택 드롭다운에 반영됨

**주의사항:**
- 카테고리명은 중복될 수 없습니다
- 이미 사용 중인 카테고리는 삭제 시 주의가 필요합니다

### 4. 서비스 메뉴 설정

**경로**: 시스템 설정 > **"메뉴 설정"**

**기능 활성화/비활성화:**
- 물품 관리: ON/OFF
- 공간 관리: ON/OFF
- 차량 관리: ON/OFF

**메뉴 라벨 커스터마이징:**
- 각 메뉴의 표시 이름 변경 가능
- 입력 필드에 직접 입력

**메뉴 순서 설정:**
- 드래그앤드롭으로 메뉴 순서 변경
- 각 메뉴 항목 왼쪽의 드래그 핸들 아이콘을 클릭하고 드래그
- 순서 변경 후 **"설정 저장"** 버튼 클릭
- 각 메뉴의 활성화/비활성화 설정

### 5. 소유권 정책 설정

**경로**: 시스템 설정 > **"정책 설정"**

**물품/공간/차량 소유권 정책:**
- **기관 공용**: 모든 부서가 사용 가능
- **부서 소유**: 특정 부서만 소유
- 각 자원 타입별로 정책 설정 가능

### 6. 반납 확인 정책

**경로**: 시스템 설정 > **"정책 설정"**

**반납 확인 절차 설정:**
- ✅ **활성화**: 반납 확인 절차 사용
- ✅ **사진 필수**: 반납 시 사진 업로드 필수
- ✅ **확인 필수**: 관리자 검증 필수

**차량 반납:**
- 계기판 사진 필수
- 외관 사진 필수
- 주행거리 입력 필수

---

## 사용자 관리

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"사용자 관리"** 또는 상단 메뉴 > **"관리" > "사용자 관리"**

### 1. 사용자 초대

**초대 링크 생성:**
1. **"사용자 권한 관리"** 페이지로 이동
2. 초대 정보 입력:
   - **이름**: 초대할 사용자 이름 (필수)
   - **이메일**: 이메일 주소 (선택사항, 가입 시 변경 가능)
   - **역할**: 드롭다운에서 선택
     - 관리자: 모든 권한
     - 부서 관리자: 부서 자원 관리
     - 일반 사용자: 조회 및 예약만
   - **부서**: 드롭다운에서 선택 (선택사항)
3. **"초대 링크 생성"** 버튼 클릭
4. 초대 링크가 생성되고 클립보드에 자동 복사됨
5. 이메일이 입력된 경우 이메일로도 전송됨

**초대 링크 전달:**
- 생성된 링크를 사용자에게 직접 전달 (카카오톡, 문자 등)
- 링크는 7일간 유효합니다
- 링크로 가입 시 이름, 역할, 부서가 자동 설정됩니다

**초대 상태 확인:**
- **대기 중**: 초대 링크 생성됨, 아직 가입 안 함
- **수락됨**: 초대 링크로 가입 완료
- **취소됨**: 초대가 취소됨

**초대 관리:**
- **링크 복사**: 초대 링크를 다시 복사
- **재전송**: 이메일이 있는 경우 이메일 재전송
- **취소**: 초대 링크 취소

### 2. 사용자 역할 관리

**역할 변경:**
1. 사용자 목록에서 대상 사용자 찾기
2. **"역할"** 드롭다운에서 새 역할 선택
3. 자동 저장됨

**역할별 권한:**
- **관리자**: 모든 기능 접근
- **부서 관리자**: 본인 부서 자원 관리, 예약 승인
- **일반 사용자**: 조회 및 예약만

### 3. 사용자 부서 할당

**부서 할당:**
1. 사용자 목록에서 대상 사용자 찾기
2. **"부서"** 드롭다운에서 부서 선택
3. 자동 저장됨

**주의사항:**
- 부서 관리자는 본인 부서의 자원만 관리할 수 있습니다
- 부서가 없으면 기관 공용 자원만 관리 가능합니다

---

## 승인 정책 설정

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"사용자 관리"** > **"승인 정책"** 탭

### 1. 승인 정책 개요

승인 정책은 **"누가 어떤 예약을 승인할 수 있는지"**를 정의합니다.

**정책 구성 요소:**
- **범위**: 물품 / 공간 / 차량
- **부서**: 특정 부서 또는 전체 기관
- **필요 역할**: 관리자 / 부서 관리자 / 일반 사용자

### 2. 정책 생성

**수동 생성:**
1. **"새 정책 추가"** 섹션에서:
   - 범위 선택 (물품/공간/차량)
   - 부서 선택 (전체 기관 또는 특정 부서)
   - 필요 역할 선택
2. **"추가"** 버튼 클릭

**템플릿 생성:**
- **"기관 공용 정책 생성"**: 모든 범위에 대한 기관 전체 정책 생성
- **"부서 정책 생성"**: 특정 부서에 대한 모든 범위 정책 생성

### 3. 정책 예시

**예시 1: 기관 공용 물품**
- 범위: 물품
- 부서: 전체 기관
- 필요 역할: 관리자
- → 관리자만 기관 공용 물품 예약 승인 가능

**예시 2: 청년부 소유 물품**
- 범위: 물품
- 부서: 청년부
- 필요 역할: 부서 관리자
- → 청년부 부서 관리자 이상만 청년부 물품 예약 승인 가능

**예시 3: 주일학교 공간**
- 범위: 공간
- 부서: 주일학교
- 필요 역할: 일반 사용자
- → 일반 사용자도 주일학교 공간 예약 승인 가능

### 4. 정책 수정 및 삭제

**정책 수정:**
- 정책 목록에서 **"필요 역할"** 드롭다운 변경
- 자동 저장됨

**정책 삭제:**
- 정책 목록에서 **"삭제"** 버튼 클릭
- 확인 후 삭제

### 5. 정책 우선순위

1. **부서별 정책** (특정 부서)
2. **기관 전체 정책** (부서가 null)
3. **기본값**: 부서 관리자 (정책이 없을 때)

---

## 자원 관리

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"자원 관리"** 또는 상단 메뉴 > **"관리" > "상태 및 예약 관리"**

### 1. 물품 관리

**물품 상태 변경:**
1. **"물품"** 탭 선택
2. 물품 목록에서 대상 물품 찾기
3. **"상태"** 드롭다운에서 상태 선택:
   - 사용 가능
   - 사용 중
   - 수리 중
   - 폐기
4. 자동 저장됨

**물품 수정:**
1. 물품 목록에서 **"수정"** 버튼 클릭
2. 수정 페이지에서 정보 변경
3. **"저장"** 버튼 클릭

**물품 삭제:**
1. 물품 상세 페이지에서 **"수정"** 버튼 클릭
2. 수정 페이지 하단의 **"삭제"** 섹션으로 스크롤
3. **"삭제"** 버튼 클릭
4. 삭제 사유 선택:
   - 불필요
   - 손상
   - 분실
   - 기타 (직접 입력)
5. **"확인"** 버튼 클릭
6. 삭제 완료 (소프트 삭제, 복원 가능)

### 2. 공간 관리

**공간 상태 변경:**
- 물품과 동일한 방식

**공간 수정:**
- 물품과 동일한 방식

### 3. 차량 관리

**차량 상태 변경:**
- 물품과 동일한 방식

**차량 수정:**
- 물품과 동일한 방식
- 주행거리 업데이트 가능

**주행거리 관리:**
- 차량 등록 시 현재 주행거리 입력
- 반납 시 최종 주행거리 자동 업데이트

### 4. 불용품 이동 요청

**물품 관리 페이지 하단**에서 불용품 이동 요청을 확인할 수 있습니다.

**요청 처리:**
1. 이동 요청 목록 확인
2. **"승인"** 또는 **"거부"** 버튼 클릭
3. 승인 시 물품 소유 부서 변경됨

---

## 예약 관리

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"자원 관리"** > 예약 관리 탭

### 1. 예약 목록 확인

**필터링:**
- 상태별 필터: 전체 / 대기 중 / 승인됨 / 반납됨 / 거부됨
- 검색: 물품명, 사용자명으로 검색

**예약 정보:**
- 물품/공간/차량명
- 사용자 정보
- 예약 기간
- 상태
- 메모

### 2. 예약 승인/거부

**승인:**
1. 예약 목록에서 **"대기 중"** 상태의 예약 찾기
2. **"승인"** 버튼 클릭
3. 확인 후 승인 완료

**거부:**
1. 예약 목록에서 **"대기 중"** 상태의 예약 찾기
2. **"거부"** 버튼 클릭
3. 거부 사유 입력 (선택사항)
4. 확인 후 거부 완료

**권한 확인:**
- 승인 정책에 따라 승인 권한이 결정됩니다
- 권한이 없으면 승인/거부 버튼이 표시되지 않습니다

### 3. 반복 예약 관리

**반복 예약:**
- 일회성 예약과 동일하게 관리
- 각 인스턴스별로 개별 승인/거부 가능

---

## 반납 확인

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"자원 관리"** > 예약 관리 탭

### 1. 반납 요청 확인

**반납 대기 목록:**
- **"반납됨"** 상태의 예약 확인
- 사용자가 업로드한 반납 사진 확인

**차량 반납:**
- 계기판 사진 확인
- 외관 사진 확인
- 주행거리 확인

### 2. 반납 검증

**검증 프로세스:**
1. 반납 요청 목록에서 대상 예약 찾기
2. **"검증"** 버튼 클릭
3. 반납 사진 및 상태 확인
4. **"상태"** 선택:
   - 정상: 이상 없음
   - 손상: 손상 있음
   - 기타: 기타 사유
5. **"메모"** 입력 (선택사항)
6. **"승인"** 또는 **"거부"** 버튼 클릭

**차량 반납 검증:**
- 주행거리 확인
- 계기판 사진과 입력된 주행거리 일치 여부 확인
- 외관 손상 여부 확인
- 승인 시 차량의 현재 주행거리 자동 업데이트

### 3. 반납 정책

**반납 확인 정책 설정:**
- **기관 설정 > 반납 확인 정책**에서 설정
- 사진 필수 여부
- 검증 필수 여부

**정책에 따른 동작:**
- 검증 불필요: 사용자 반납 시 즉시 완료
- 검증 필수: 관리자 검증 후 완료

---

## 감사 로그

**경로**: 상단 메뉴 > 사용자 메뉴 > **"관리페이지"** > **"시스템 설정"** > **"감사 로그"** 또는 상단 메뉴 > **"관리" > "감사 로그"**

### 1. 로그 확인

**로그 유형:**
- 자원 등록/수정/삭제
- 예약 생성/승인/거부
- 사용자 역할 변경
- 정책 생성/수정/삭제
- 기관 설정 변경

**필터링:**
- 행위자: 특정 사용자
- 기간: 시작일 ~ 종료일
- 액션: 특정 액션 타입

### 2. 로그 정보

**로그 항목:**
- 타임스탬프
- 행위자 (사용자)
- 액션 타입
- 대상 타입 및 ID
- 메타데이터

**메타데이터:**
- 변경 전/후 값
- 추가 정보

---

## 주요 팁

### 1. 효율적인 관리

- **부서 관리자 활용**: 각 부서에 부서 관리자를 지정하여 분산 관리
- **승인 정책 설정**: 부서별로 적절한 승인 정책 설정
- **정기 점검**: 감사 로그를 통해 정기적으로 활동 확인

### 2. 문제 해결

**예약 승인 불가:**
- 승인 정책 확인
- 사용자 역할 확인
- 부서 소유권 확인

**반납 확인 불가:**
- 반납 확인 정책 확인
- 사용자 반납 완료 여부 확인

### 3. 데이터 백업

- 정기적으로 Supabase 대시보드에서 데이터 백업
- 중요 설정은 별도 문서로 기록

---

**문의**: 관리 관련 문의사항은 시스템 관리자에게 연락하세요.
