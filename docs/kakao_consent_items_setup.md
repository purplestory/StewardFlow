# 카카오 로그인 동의 항목 설정 가이드

## 오류: "잘못된 요청 (KOE205)"

### 오류 원인
카카오 개발자 센터에서 동의 항목을 설정하지 않았거나, Supabase가 요청하는 동의 항목이 활성화되지 않아 발생합니다.

### 오류 메시지 예시
```
설정하지 않은 카카오 로그인 동의 항목을 포함해 인가 코드를 요청했습니다.
설정하지 않은 동의 항목: account_email, profile_image, profile_nickname
```

## 해결 방법

### 1단계: 카카오 개발자 센터로 이동

1. https://developers.kakao.com 접속
2. **"내 애플리케이션"** 클릭
3. **"스튜어드 플로우"** 앱 선택

### 2단계: 동의 항목 설정 메뉴로 이동

1. 왼쪽 메뉴에서 **"제품 설정"** 클릭
2. 하위 메뉴에서 **"카카오 로그인"** 클릭
3. 다시 하위 메뉴에서 **"동의항목"** 클릭

### 3단계: 필수 동의 항목 설정

#### 카카오계정(이메일) - account_email (선택)

> ⚠️ **주의**: 이 항목이 "권한 없음"으로 표시되는 경우, 건너뛰어도 됩니다. 이메일 없이도 카카오 로그인이 가능합니다.

1. **"카카오계정(이메일)"** 항목 찾기
2. **"활성화"** 토글을 **ON**으로 변경 (가능한 경우)
   - "권한 없음"으로 표시되면 건너뛰기
3. 필수 여부: **선택**
4. 목적: 이메일 로그인에 필요 (없어도 로그인 가능)

> 💡 **"권한 없음"인 경우**: 닉네임과 프로필 사진만 활성화해도 충분합니다. 자세한 내용은 `docs/kakao_email_consent_issue.md`를 참고하세요.

### 4단계: 선택 동의 항목 설정

#### 닉네임 - profile_nickname

1. **"닉네임"** 또는 **"프로필 정보"** 항목 찾기
2. **"활성화"** 토글을 **ON**으로 변경
3. 필수 여부: **선택**
4. 목적: 사용자 이름 표시

#### 프로필 사진 - profile_image

1. **"프로필 사진"** 또는 **"프로필 이미지"** 항목 찾기
2. **"활성화"** 토글을 **ON**으로 변경
3. 필수 여부: **선택**
4. 목적: 프로필 이미지 표시

### 5단계: 저장

1. 모든 동의 항목 설정 완료 후
2. **"저장"** 또는 **"적용"** 버튼 클릭
3. 저장 완료 메시지 확인

## 설정해야 할 동의 항목 목록

| 동의 항목 | ID | 필수 여부 | 설명 | 비고 |
|---------|-----|---------|------|------|
| 카카오계정(이메일) | `account_email` | 선택 | 이메일 정보 | ⚠️ "권한 없음"인 경우 건너뛰기 가능 |
| 닉네임 | `profile_nickname` | 선택 (권장) | 사용자 이름 | ✅ 필수 활성화 |
| 프로필 사진 | `profile_image` | 선택 | 프로필 이미지 | ✅ 필수 활성화 |

> 💡 **참고**: 이메일 동의 항목이 "권한 없음"으로 표시되는 경우, 닉네임과 프로필 사진만 활성화해도 카카오 로그인이 가능합니다. 자세한 내용은 `docs/kakao_email_consent_issue.md`를 참고하세요.

## 동의 항목 설정 화면 예시

```
┌─────────────────────────────────────────┐
│ 동의항목 설정                           │
├─────────────────────────────────────────┤
│                                         │
│ 카카오계정(이메일)                      │
│ 활성화: [ON]  필수: [선택]             │
│                                         │
│ 닉네임                                   │
│ 활성화: [ON]  필수: [선택]             │
│                                         │
│ 프로필 사진                              │
│ 활성화: [ON]  필수: [선택]             │
│                                         │
│ [저장] [취소]                            │
└─────────────────────────────────────────┘
```

## ⚠️ 주의사항

### 모든 항목 활성화 권장
- Supabase가 요청하는 동의 항목을 모두 활성화하는 것을 권장합니다
- 활성화하지 않으면 오류가 발생할 수 있습니다

### 필수 vs 선택
- 대부분의 항목은 "선택"으로 설정해도 됩니다
- 사용자가 동의하지 않아도 로그인은 가능하지만, 해당 정보는 받을 수 없습니다

### 저장 필수
- 동의 항목 설정 후 반드시 "저장" 버튼을 클릭해야 합니다
- 저장하지 않으면 설정이 적용되지 않습니다

## ✅ 설정 완료 체크리스트

- [ ] 카카오 개발자 센터 → "내 애플리케이션" → "스튜어드 플로우" 선택
- [ ] "제품 설정" → "카카오 로그인" → "동의항목" 메뉴로 이동
- [ ] "카카오계정(이메일)" 활성화: ON
- [ ] "닉네임" 활성화: ON
- [ ] "프로필 사진" 활성화: ON
- [ ] "저장" 버튼 클릭
- [ ] 저장 완료 확인

## 🧪 테스트

설정 완료 후:

1. 브라우저 새로고침
2. `/login` 페이지 접속
3. "카카오톡으로 로그인" 버튼 클릭
4. 카카오 로그인 화면에서 동의 항목이 표시되는지 확인
5. 로그인 성공 확인

## 🔍 문제 해결

### 여전히 오류가 발생하는 경우

1. **동의 항목이 정확히 활성화되었는지 확인**
   - 각 항목의 "활성화" 토글이 ON인지 확인
   - 저장 버튼을 클릭했는지 확인

2. **브라우저 캐시 클리어**
   - 브라우저 새로고침
   - 시크릿 모드에서 테스트

3. **Supabase 설정 확인**
   - Supabase 대시보드에서 Kakao Provider 설정 확인
   - Client ID와 Client Secret이 정확한지 확인

4. **잠시 대기**
   - 카카오 설정 변경이 전파되는데 시간이 걸릴 수 있습니다
   - 1-2분 정도 기다린 후 다시 시도
